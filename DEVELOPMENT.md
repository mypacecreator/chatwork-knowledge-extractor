# 開発進捗

## 2025-02-09

### 初期実装完了
- プロジェクト構造作成
- Chatwork API連携実装
- Claude Batch API連携実装
- Markdown/JSON出力実装

### 未実装・今後の課題

#### Phase 1: 動作確認（優先度：高）
- [ ] npm install実行
- [ ] Chatwork API疎通確認
- [ ] Claude Batch API疎通確認
- [ ] 実際のデータでテスト実行

#### Phase 2: 基本機能改善（優先度：高）
- [ ] エラーハンドリング強化
- [ ] レート制限への対応確認
- [ ] Batch API完了待機のタイムアウト処理

#### Phase 3: 拡張機能（優先度：中）
- [ ] ページネーション実装（100件以上取得）
- [ ] 進捗表示の改善
- [ ] ログ出力の整理

#### Phase 4: 仕上げ（優先度：低）
- [ ] README更新
- [ ] 使い方ドキュメント追加
- [ ] OSS化準備

### メモ・気づき

- Chatwork APIは100件ずつしか取得できない
- force=1で最新100件、force=0で差分取得
- Batch APIは数分〜数十分かかる想定
- レート制限: 5分300回、メッセージ取得は10秒10回

### 次回やること

1. npm installして依存関係インストール
2. 実際にAPIに接続してテスト
3. エラーがあれば修正

---

## 2026-02-09（追加要件）

### 汎用性判定の4段階レベル化

**背景:**
初回実装では3段階（high/medium/low）だったが、実際の出力を確認したところ、案件固有の内容が混ざっていた。より厳格な判定のため、4段階に変更する。

**新しいレベル定義:**

1. **high** - 普遍的な技術知見（どの案件でも活用可能）
   - 例: "WordPressの本番環境ではWP_DEBUGをfalseに設定する"
   - 例: "CSSのtransformはrepaintを発生させないため高速"

2. **medium** - 業界・技術領域特有の知見
   - 例: "不動産サイトでは物件詳細にGoogleマップ埋め込みが必須"
   - 例: "BtoB製造業サイトではPDFカタログ機能が重視される"

3. **low** - ケースバイケースだが参考になる判断例
   - 例: "クライアントが好む競合サイトの雰囲気は提案に反映すべき"
   - 例: "素材未確定時はダミーで仮配置し、確定後に調整する"

4. **exclude** - 案件固有の指示・定型文（完全除外）
   - 例: "メインカラーは#3498db"
   - 例: "了解しました"

**実装タスク:**

- [ ] src/claude/analyzer.ts の型定義を変更（'exclude' を追加）
- [ ] createAnalysisPrompt() のプロンプトを全面改訂
  - 4段階の判定基準を詳細に記載
  - 架空の具体例を含める（実際のチャット内容を使わない）
  - 判定の鉄則を明記
- [ ] src/index.ts にフィルタリングロジック追加
  - exclude を完全除外
  - 環境変数 OUTPUT_VERSATILITY で出力範囲を制御
  - デフォルトは "high,medium"
- [ ] .env.example と .env に OUTPUT_VERSATILITY を追加

**プロンプト改善のポイント:**
- 案件固有の内容（具体的な数値、色コード、固有名詞）→ exclude
- 「この案件では」「今回は」などの限定表現 → exclude
- 挨拶、確認、スケジュール調整 → exclude
- 技術的理由や原則の説明がある → high
- 業界特有のパターン → medium
- 状況判断のアプローチ → low

---
